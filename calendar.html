<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</title>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
  <style>
    body { font-family: "Segoe UI"; background:#fef9f4; padding:20px; }
    h2 { text-align:center; color:#5a4636; }
    #calendar { max-width: 900px; margin: 20px auto; background:#fff; padding:10px; border-radius:10px; box-shadow:0 4px 8px rgba(0,0,0,0.1);}    
    .modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.4); }
    .modal-content { background:#fffaf5; margin:10% auto; padding:20px; border-radius:10px; width:350px; box-shadow:0 6px 12px rgba(0,0,0,0.2); position:relative; }
    .close { position:absolute; right:10px; top:10px; cursor:pointer; font-size:18px; }
    .close:hover { color:red; }
  </style>
</head>
<body>
  <h2>üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</h2>
  <div style="text-align:center; margin-bottom:10px;">
    <button onclick="window.location.href='admin.html'" style="background:#88ada6; color:#fff; padding:8px 16px; border:none; border-radius:8px; cursor:pointer;">‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</button>
  </div>
  <div id="calendar"></div>

  <div id="eventModal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeEventModal">&times;</span>
      <h3>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h3>
      <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á:</strong> <span id="eName"></span></p>
      <p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</strong> <span id="eType"></span></p>
      <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> <span id="eDate"></span></p>
      <p><strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> <span id="eTime"></span></p>
      <p><strong>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå:</strong> <span id="ePurpose"></span></p>
      <p><strong>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå:</strong> <span id="eEquip"></span></p>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', async function () {
    async function fetchEvents() {
      const res = await fetch('/approved-bookings?ts=' + Date.now());
      const bookings = await res.json();
      return bookings.map(b => ({
        title: b.name,
        start: `${b.date}T${b.time}`,
        end: `${b.date}T${b.end_time}`,
        extendedProps: {
          name: b.name,
          type: b.type,
          date: b.date,
          time: b.time,
          end_time: b.end_time,
          purpose: b.purpose,
          equipment: b.equipment
        }
      }));
    }

    const calendarEl = document.getElementById('calendar');
    const events = await fetchEvents();
    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      locale: 'th',
      events: events,
      eventClick: function(info) {
        document.getElementById("eName").innerText = info.event.extendedProps.name;
        document.getElementById("eType").innerText = info.event.extendedProps.type;
        document.getElementById("eDate").innerText = info.event.extendedProps.date;
        document.getElementById("eTime").innerText = info.event.extendedProps.time + " - " + info.event.extendedProps.end_time;
        document.getElementById("ePurpose").innerText = info.event.extendedProps.purpose;
        document.getElementById("eEquip").innerText = info.event.extendedProps.equipment || "-";
        document.getElementById("eventModal").style.display = "block";
      }
    });
    calendar.render();

    document.getElementById("closeEventModal").onclick = () => {
      document.getElementById("eventModal").style.display = "none";
    };
  });
  </script>
